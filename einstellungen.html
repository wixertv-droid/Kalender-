<!DOCTYPE html>
<html lang="de">
<head>
    <script>
        // HÄRTESTER TÜRSTEHER DER WELT
        if (!sessionStorage.getItem('authKey')) {
            window.location.replace('index.html');
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Agenda 2050 | Setup</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js" defer></script>
</head>
<body>

    <div class="loader-container" id="app-loader">
        <div class="cyber-spinner"></div>
        <div class="loader-text">ACCESSING CONFIG...</div>
    </div>

    <div class="dashboard">
        <div class="btn-cyber btn-settings" onclick="location.href='woche.html'">⬅️</div>
        
        <div class="header-info">
            <div class="titel-neon">Setup</div>
            <div class="countdown-pulsing">System-Konfiguration</div>
        </div>
        
        <div style="width: 65px; height: 65px;"></div>
    </div>

    <div class="settings-container">
        
        <div class="settings-card">
            <div class="setting-title">Sicherheits-Protokoll (PIN)</div>
            <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 20px;">Ändere den Zugangscode für die App (Standard: 0000).</p>
            <div style="display: flex; gap: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label class="input-label">Aktuelle PIN</label>
                    <input type="password" id="oldPin" class="cyber-input-full" placeholder="****" inputmode="numeric">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label class="input-label">Neue PIN</label>
                    <input type="password" id="newPin" class="cyber-input-full" placeholder="4 Ziffern" inputmode="numeric">
                </div>
            </div>
            <button onclick="changeSystemPin()" class="btn-save" style="margin-top: 10px;">PIN Aktualisieren</button>
        </div>

        <div class="settings-card">
            <div class="setting-title">Zeit-Matrix (Arbeitszeit)</div>
            <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 20px;">Definiert die Breite der Timeline in der Wochenansicht.</p>
            <div style="display: flex; gap: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label class="input-label">Tagesbeginn</label>
                    <input type="time" id="arbeitsStart" class="cyber-input-full">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label class="input-label">Tagesende</label>
                    <input type="time" id="arbeitsEnde" class="cyber-input-full">
                </div>
            </div>
        </div>

        <div class="settings-card">
            <div class="setting-title">Kategorie-Verschlüsselung</div>
            
            <div class="kat-setup-row">
                <input type="color" id="kat1_farbe" class="cyber-color">
                <div style="flex-grow:1;">
                    <label class="input-label">Kategorie 1</label>
                    <input type="text" id="kat1_name" class="cyber-input-full">
                </div>
            </div>

            <div class="kat-setup-row">
                <input type="color" id="kat2_farbe" class="cyber-color">
                <div style="flex-grow:1;">
                    <label class="input-label">Kategorie 2</label>
                    <input type="text" id="kat2_name" class="cyber-input-full">
                </div>
            </div>

            <div class="kat-setup-row">
                <input type="color" id="kat3_farbe" class="cyber-color">
                <div style="flex-grow:1;">
                    <label class="input-label">Kategorie 3</label>
                    <input type="text" id="kat3_name" class="cyber-input-full">
                </div>
            </div>
        </div>

        <div class="settings-card">
            <div class="setting-title">Kommunikations-Kanäle</div>
            <div class="form-group">
                <label class="input-label">Plattform 1</label>
                <input type="text" id="plat1" class="cyber-input-full">
            </div>
            <div class="form-group">
                <label class="input-label">Plattform 2</label>
                <input type="text" id="plat2" class="cyber-input-full">
            </div>
            <div class="form-group">
                <label class="input-label">Plattform 3</label>
                <input type="text" id="plat3" class="cyber-input-full">
            </div>
            <div class="form-group">
                <label class="input-label">Plattform 4</label>
                <input type="text" id="plat4" class="cyber-input-full">
            </div>
        </div>

        <button class="btn-save" id="save-btn" onclick="saveSystemSettings()">KONFIGURATION SPEICHERN</button>
        
        <button onclick="location.href='woche.html'" style="width: 100%; background: none; border: none; color: #555; font-size: 1rem; padding: 20px; text-transform: uppercase; cursor: pointer; letter-spacing: 2px;">Abbrechen</button>

        <div class="danger-zone">
            <div class="danger-title">Danger Zone</div>
            <button class="btn-danger" onclick="resetAllData()">Alle Termine löschen</button>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('appEinstellungen');
            const d = {
                arbeitsStart: '08:00',
                arbeitsEnde: '22:00',
                kat1_name: 'VIP', kat1_farbe: '#e5b05c',
                kat2_name: 'Stamm', kat2_farbe: '#ff2a6d',
                kat3_name: 'Neu', kat3_farbe: '#05d9e8',
                plat1: 'WhatsApp', plat2: 'Instagram', plat3: 'Telegram', plat4: 'Telefon'
            };
            
            const s = saved ? JSON.parse(saved) : d;

            document.getElementById('arbeitsStart').value = s.arbeitsStart || d.arbeitsStart;
            document.getElementById('arbeitsEnde').value = s.arbeitsEnde || d.arbeitsEnde;

            document.getElementById('kat1_name').value = s.kat1_name || d.kat1_name;
            document.getElementById('kat1_farbe').value = s.kat1_farbe || d.kat1_farbe;
            document.getElementById('kat2_name').value = s.kat2_name || d.kat2_name;
            document.getElementById('kat2_farbe').value = s.kat2_farbe || d.kat2_farbe;
            document.getElementById('kat3_name').value = s.kat3_name || d.kat3_name;
            document.getElementById('kat3_farbe').value = s.kat3_farbe || d.kat3_farbe;
            
            document.getElementById('plat1').value = s.plat1 || d.plat1;
            document.getElementById('plat2').value = s.plat2 || d.plat2;
            document.getElementById('plat3').value = s.plat3 || d.plat3;
            document.getElementById('plat4').value = s.plat4 || d.plat4;

            setTimeout(() => {
                const loader = document.getElementById('app-loader');
                if(loader) { loader.style.opacity = '0'; setTimeout(() => loader.remove(), 500); }
            }, 400);
        });

        function changeSystemPin() {
            const oldInput = document.getElementById('oldPin').value;
            const newInput = document.getElementById('newPin').value;
            const currentPin = localStorage.getItem('appPin') || "0000";

            if (oldInput !== currentPin) {
                alert("❌ Die aktuelle PIN ist falsch!");
                return;
            }
            if (newInput.length !== 4) {
                alert("⚠️ Die neue PIN muss genau 4 Ziffern lang sein!");
                return;
            }

            localStorage.setItem('appPin', newInput);
            alert("✅ System-PIN wurde erfolgreich aktualisiert!");
            document.getElementById('oldPin').value = '';
            document.getElementById('newPin').value = '';
        }

        function saveSystemSettings() {
            const btn = document.getElementById('save-btn');
            btn.innerText = "SAVING...";
            
            const newSettings = {
                arbeitsStart: document.getElementById('arbeitsStart').value || '08:00',
                arbeitsEnde: document.getElementById('arbeitsEnde').value || '22:00',
                wochenstart: 'MO',
                kat1_name: document.getElementById('kat1_name').value,
                kat1_farbe: document.getElementById('kat1_farbe').value,
                kat2_name: document.getElementById('kat2_name').value,
                kat2_farbe: document.getElementById('kat2_farbe').value,
                kat3_name: document.getElementById('kat3_name').value,
                kat3_farbe: document.getElementById('kat3_farbe').value,
                plat1: document.getElementById('plat1').value,
                plat2: document.getElementById('plat2').value,
                plat3: document.getElementById('plat3').value,
                plat4: document.getElementById('plat4').value
            };

            localStorage.setItem('appEinstellungen', JSON.stringify(newSettings));
            
            btn.style.background = "var(--neon-green)";
            btn.innerText = "SYSTEM UPDATED!";
            
            setTimeout(() => { location.href = 'woche.html'; }, 800);
        }

        function resetAllData() {
            if(confirm("SYSTEMWARNUNG: Alle Termine werden unwiderruflich auch in der CLOUD gelöscht!")) {
                const btn = document.querySelector('.btn-danger');
                if(btn) {
                    btn.innerText = "LÖSCHEN LÄUFT...";
                    btn.style.opacity = "0.7";
                }
                
                // Sauberes Array speichern -> Cloud Sync wird getriggert
                localStorage.setItem('appTermine', JSON.stringify([]));
                
                // 1,5 Sekunden warten (Upload-Zeit) und dann automatisch zurück in die Woche
                setTimeout(() => {
                    window.location.href = 'woche.html';
                }, 1500);
            }
        }
    </script>
</body>
</html>
