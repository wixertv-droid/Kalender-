<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Agenda 2050 | Jahreskalender</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js" defer></script>
</head>
<body>

    <div class="loader-container" id="app-loader">
        <div class="cyber-spinner"></div>
        <div class="loader-text">CALCULATING ORBIT...</div>
    </div>

    <div class="dashboard">
        <div class="btn-cyber btn-settings" onclick="location.href='woche.html'" title="Zurück zur Woche">⬅️</div>
        
        <div class="header-info">
            <div class="titel-neon">Kalender</div>
            <div class="countdown-pulsing" id="jahr-titel">2026</div>
        </div>
        
        <div style="display: flex; gap: 15px;">
            <div class="btn-cyber" onclick="wechsleJahr(-1)" style="color: var(--neon-cyan); border-color: var(--neon-cyan); font-size: 1.2rem;">⏮</div>
            <div class="btn-cyber" onclick="wechsleJahr(1)" style="color: var(--neon-cyan); border-color: var(--neon-cyan); font-size: 1.2rem;">⏭</div>
        </div>
    </div>

    <div class="jahr-container" id="kalender-grid-container"></div>

    <script>
        let currentJahr = new Date().getFullYear();

        function renderJahr(jahr) {
            document.getElementById('jahr-titel').innerText = jahr;
            const container = document.getElementById('kalender-grid-container');
            container.innerHTML = '';

            const monate = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            const heute = new Date();
            const heuteISO = new Date(heute.getTime() - (heute.getTimezoneOffset() * 60000)).toISOString().split('T')[0];

            for (let m = 0; m < 12; m++) {
                let karte = document.createElement('div');
                karte.className = 'monat-karte';
                
                let html = `<div class="monat-titel">${monate[m]}</div>`;
                html += `<div class="kalender-grid">
                            <div class="kalender-wochentag">Mo</div>
                            <div class="kalender-wochentag">Di</div>
                            <div class="kalender-wochentag">Mi</div>
                            <div class="kalender-wochentag">Do</div>
                            <div class="kalender-wochentag">Fr</div>
                            <div class="kalender-wochentag">Sa</div>
                            <div class="kalender-wochentag">So</div>`;
                
                // Erster Tag des Monats
                let ersterTagDate = new Date(jahr, m, 1);
                let ersterWochentag = ersterTagDate.getDay(); // 0=So, 1=Mo...
                
                // Korrektur auf Mo=0, Di=1... So=6
                let offset = (ersterWochentag === 0) ? 6 : ersterWochentag - 1;
                
                let tageImMonat = new Date(jahr, m + 1, 0).getDate();
                
                // 1. Leere Felder am Anfang
                for (let i = 0; i < offset; i++) {
                    html += `<div class="kalender-tag leer"></div>`;
                }

                // 2. Die Tage des Monats
                for (let tag = 1; tag <= tageImMonat; tag++) {
                    // Wochen-ID berechnen basierend auf dem Gesamtraster (für den Hover-Effekt)
                    let positionImGrid = offset + tag - 1;
                    let wochenId = Math.floor(positionImGrid / 7);
                    
                    let iso = `${jahr}-${String(m+1).padStart(2,'0')}-${String(tag).padStart(2,'0')}`;
                    let isHeute = (iso === heuteISO) ? 'heute-markierung' : '';

                    html += `<div class="kalender-tag ${isHeute}" 
                                  data-wochenid="w-${m}-${wochenId}" 
                                  onclick="location.href='woche.html?d=${iso}'" 
                                  onmouseenter="highlightWoche('w-${m}-${wochenId}')" 
                                  onmouseleave="removeHighlight()">${tag}</div>`;
                }

                html += `</div>`;
                karte.innerHTML = html;
                container.appendChild(karte);
            }
        }

        function wechsleJahr(richtung) {
            currentJahr += richtung;
            renderJahr(currentJahr);
        }

        function highlightWoche(wochenId) {
            document.querySelectorAll(`[data-wochenid="${wochenId}"]`).forEach(el => {
                el.classList.add('hover-woche');
            });
        }

        function removeHighlight() {
            document.querySelectorAll('.kalender-tag').forEach(el => {
                el.classList.remove('hover-woche');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderJahr(currentJahr);
            setTimeout(() => {
                const loader = document.getElementById('app-loader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 500);
                }
            }, 400);
        });
    </script>
</body>
</html>
